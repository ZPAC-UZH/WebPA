---
title: "Generate files for groups"
---

```{r, include=FALSE, message=FALSE, results='hide', warning=FALSE, error=FALSE}
library(readxl)
library(tidyverse)
# requires Java
library("xlsx")
library(tibble)
library(dplyr)
```

```{r}
path_input <- "../input"
path_output <- "../output"
```


Prepare the template.
```{r}
template_df <- read_excel(file.path(path_input, "template.xlsx"))
last_template_row <- which(template_df[1] == "My name (x)")
template_head <- head(template_df, last_template_row) %>%
  add_column(
    "empty" = NA,
    "Person" = NA,
    "empty2" = NA,
    "empty3" = NA,
    "Team" = NA)
```

Process student data to generate templates
```{r}
groups_data <- read_excel(file.path(path_input, "students_groups.xlsx"))
data_list <- split(groups_data, f = groups_data$Team) 
for (i in 1:last(groups_data$Team)) {
  group_name = ifelse(i >= 10, toString(i), paste("0", toString(i), sep =""))
  name = file.path(path_output, "template_for_students", paste("Peer assessment Team", group_name))
  file_name = paste(name, ".xlsx", sep="")
  df <- data_list[[i]]
  df <- df %>% 
    add_column(empty = NA, .before = 'Person') %>%
    add_column(empty2 = NA, .after = 'Person') %>%
    add_column(empty3 = NA, .before = 'Team') 
  write.xlsx(as.data.frame(rbind(template_head, df)), file_name, col.names = FALSE, showNA = FALSE, row.names = FALSE)
}
```





