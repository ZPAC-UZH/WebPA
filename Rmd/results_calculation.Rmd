---
title: "Calculate the grading adjustment factor accordinng to WebPA"
---

```{r, include=FALSE, message=FALSE, results='hide', warning=FALSE, error=FALSE}
library(tidyverse)
library(readxl)
library(xlsx)

source("R/calculate_rating.R")
options("dplyr.summarise.inform" = FALSE)  # disables warning in dplyr::summary() (experimental lifecycle)

```
```{r}
path_input <- "../input"
path_output <- file.path("../output", "calculated_adjustments.xlsx")
```

Read the sizes of the groups from sizes.csv.  
Set path to submissions folder with the following structure:  
- submissions/  
  - group_01/  
    - file1.xlsx  (NOTE: the file name doesn't matter)
    - file2.xlsx
    ...
  - group_02/  
    - file1.xlsx
    - file2.xlsx

```{r}
sizes_df <- 
  read_excel(file.path(path_input, "students_groups.xlsx")) %>% 
  group_by(Team) %>% 
  summarize(group_size = n()) %>% 
  ungroup() %>% 
  select(group_number = Team, group_size)

groups_paths <- list.files(file.path(path_input, "submitted_ratings") , full.names = TRUE)
```

```{r}
for (path in groups_paths) {
  results <- rbind(results, calculate_rating(path, i, sizes_df$group_size[sizes_df$group_number==i]))
}

# saves excel file with the results
write.xlsx(as.data.frame(results), path_output, col.names = TRUE, showNA = FALSE, row.names = FALSE)
```

To view results here:
```{r}
results
```







